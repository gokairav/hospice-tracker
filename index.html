<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expert Hospice Marketing Tracker</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui, -apple-system, sans-serif; }
        #root { min-height: 100vh; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script type="text/babel">
function HospiceTracker() {
  const [currentUser, setCurrentUser] = useState(null);
  const [loginForm, setLoginForm] = useState({ username: '', pin: '' });
  const [loginError, setLoginError] = useState('');
  const [visits, setVisits] = useState([]);
  const [clients, setClients] = useState([]);
  const [reminders, setReminders] = useState([]);
  const [users, setUsers] = useState([]);
  const [activeView, setActiveView] = useState('dashboard');
  const [showForm, setShowForm] = useState(false);
  const [editingId, setEditingId] = useState(null);
  const [clientSearch, setClientSearch] = useState('');
  const [showSuggestions, setShowSuggestions] = useState(false);
  const [formData, setFormData] = useState({
    clientName: '', clientAddress: '', clientEmail: '', contactPerson: '',
    visitDate: new Date().toISOString().split('T')[0], notes: '',
    patients: [], reminderDate: '', reminderNote: ''
  });
  const [patientForm, setPatientForm] = useState({ name: '', phone: '', type: 'lead' });

  // Storage wrapper with localStorage fallback
  const storage = {
    async get(key) {
      try {
        if (window.storage) {
          return await storage.get(key);
        }
      } catch (error) {
        console.log('Persistent storage failed, using localStorage');
      }
      // Fallback to localStorage
      const value = localStorage.getItem(key);
      return value ? { key, value } : null;
    },
    async set(key, value) {
      try {
        if (window.storage) {
          return await storage.set(key, value);
        }
      } catch (error) {
        console.log('Persistent storage failed, using localStorage');
      }
      // Fallback to localStorage
      localStorage.setItem(key, value);
      return { key, value };
    },
    async delete(key) {
      try {
        if (window.storage) {
          return await storage.delete(key);
        }
      } catch (error) {
        console.log('Persistent storage failed, using localStorage');
      }
      // Fallback to localStorage
      localStorage.removeItem(key);
      return { key, deleted: true };
    },
    async list(prefix) {
      try {
        if (window.storage) {
          return await storage.list(prefix);
        }
      } catch (error) {
        console.log('Persistent storage failed, using localStorage');
      }
      // Fallback to localStorage
      const keys = [];
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key.startsWith(prefix)) {
          keys.push(key);
        }
      }
      return { keys };
    }
  };

  useEffect(() => { initializeApp(); }, []);
  useEffect(() => { if (currentUser) loadData(); }, [currentUser]);

  const initializeApp = async () => {
    try {
      console.log('Initializing app...');
      const usersResult = await storage.get('hospice:users');
      
      if (!usersResult) {
        const defaultUsers = [
          { username: 'skrishnan', pin: '', role: 'admin', name: 'S. Krishnan' },
          { username: 'mranat', pin: '', role: 'admin', name: 'M. Ranat' },
          { username: 'bmartin', pin: '', role: 'admin', name: 'B. Martin' },
          { username: 'jgiedt', pin: '', role: 'admin', name: 'J. Giedt' },
          { username: 'denise', pin: '', role: 'marketer', name: 'Denise' },
          { username: 'braxton', pin: '', role: 'marketer', name: 'Braxton' },
          { username: 'liesa', pin: '', role: 'marketer', name: 'Liesa' },
          { username: 'veronica', pin: '', role: 'marketer', name: 'Veronica' }
        ];
        console.log('Initializing default users...');
        await storage.set('hospice:users', JSON.stringify(defaultUsers));
        setUsers(defaultUsers);
        console.log('Users initialized successfully');
      } else {
        const loadedUsers = JSON.parse(usersResult.value);
        setUsers(loadedUsers);
        console.log('Loaded existing users:', loadedUsers.map(u => u.username));
      }
    } catch (error) {
      console.error('Init error:', error);
      setLoginError('Failed to initialize. Error: ' + error.message);
    }
  };

  const loadData = async () => {
    try {
      const usersResult = await storage.get('hospice:users');
      if (usersResult) setUsers(JSON.parse(usersResult.value));

      const visitsKeys = await storage.list('visit:');
      if (visitsKeys?.keys) {
        const allVisits = (await Promise.all(
          visitsKeys.keys.map(async (key) => {
            try {
              const r = await storage.get(key);
              return r ? JSON.parse(r.value) : null;
            } catch { return null; }
          })
        )).filter(Boolean);
        
        const filtered = currentUser.role === 'admin' ? allVisits : allVisits.filter(v => v.marketer === currentUser.username);
        setVisits(filtered.sort((a, b) => new Date(b.visitDate) - new Date(a.visitDate)));
        
        const uniqueClients = {};
        filtered.forEach(v => {
          const key = v.clientName.toLowerCase();
          if (!uniqueClients[key]) {
            uniqueClients[key] = {
              name: v.clientName, address: v.clientAddress, email: v.clientEmail,
              contactPerson: v.contactPerson, lastVisit: v.visitDate, totalVisits: 1,
              totalLeads: v.patients?.filter(p => p.type === 'lead').length || 0,
              totalAdmissions: v.patients?.filter(p => p.type === 'admission').length || 0
            };
          } else {
            const c = uniqueClients[key];
            c.totalVisits++;
            c.totalLeads += v.patients?.filter(p => p.type === 'lead').length || 0;
            c.totalAdmissions += v.patients?.filter(p => p.type === 'admission').length || 0;
            if (new Date(v.visitDate) > new Date(c.lastVisit)) c.lastVisit = v.visitDate;
          }
        });
        setClients(Object.values(uniqueClients));
      }

      const remKeys = await storage.list('reminder:');
      if (remKeys?.keys) {
        const allRem = (await Promise.all(
          remKeys.keys.map(async (key) => {
            try {
              const r = await storage.get(key);
              return r ? JSON.parse(r.value) : null;
            } catch { return null; }
          })
        )).filter(Boolean).filter(r => !r.completed);
        
        const filtered = currentUser.role === 'admin' ? allRem : allRem.filter(r => r.marketer === currentUser.username);
        setReminders(filtered.sort((a, b) => new Date(a.reminderDate) - new Date(b.reminderDate)));
      }
    } catch (error) {
      console.error('Load error:', error);
    }
  };

  const handleLogin = async () => {
    setLoginError('');
    
    console.log('Login attempt:', loginForm.username);
    
    if (!loginForm.username || !loginForm.pin) {
      setLoginError('Please enter username and PIN');
      return;
    }

    if (loginForm.pin.length !== 4) {
      setLoginError('PIN must be exactly 4 digits');
      return;
    }

    try {
      const usersResult = await storage.get('hospice:users');
      console.log('Users result:', usersResult ? 'found' : 'not found');
      
      if (!usersResult) {
        setLoginError('System not initialized. Please refresh the page.');
        return;
      }

      const allUsers = JSON.parse(usersResult.value);
      console.log('Available users:', allUsers.map(u => u.username).join(', '));
      
      const user = allUsers.find(u => u.username.toLowerCase() === loginForm.username.toLowerCase());
      
      if (!user) {
        setLoginError(`Username "${loginForm.username}" not found. Valid usernames: ${allUsers.map(u => u.username).join(', ')}`);
        return;
      }

      console.log('User found:', user.username, 'Has PIN:', !!user.pin);

      // First time login - set PIN
      if (!user.pin || user.pin === '') {
        console.log('Setting new PIN for user:', user.username);
        user.pin = loginForm.pin;
        await storage.set('hospice:users', JSON.stringify(allUsers));
        setUsers(allUsers);
        setCurrentUser(user);
        setLoginForm({ username: '', pin: '' });
        console.log('PIN set successfully, logged in');
        return;
      }

      // Returning user - check PIN
      console.log('Checking PIN for returning user');
      if (user.pin === loginForm.pin) {
        console.log('PIN correct, logging in');
        setCurrentUser(user);
        setLoginForm({ username: '', pin: '' });
      } else {
        console.log('PIN incorrect');
        setLoginError('Incorrect PIN. Please try again.');
      }
    } catch (error) {
      console.error('Login error details:', error);
      setLoginError(`Login failed: ${error.message}`);
    }
  };

  const selectClient = (client) => {
    setFormData({
      ...formData,
      clientName: client.name,
      clientAddress: client.address || '',
      clientEmail: client.email || '',
      contactPerson: client.contactPerson || ''
    });
    setClientSearch(client.name);
    setShowSuggestions(false);
  };

  const addPatient = () => {
    if (!patientForm.name) return;
    setFormData({
      ...formData,
      patients: [...formData.patients, { ...patientForm, id: `p_${Date.now()}` }]
    });
    setPatientForm({ name: '', phone: '', type: 'lead' });
  };

  const removePatient = (id) => {
    setFormData({ ...formData, patients: formData.patients.filter(p => p.id !== id) });
  };

  const saveVisit = async () => {
    if (!formData.clientName || !formData.visitDate) return;

    const visit = {
      ...formData,
      id: editingId || `visit_${Date.now()}`,
      marketer: currentUser.username,
      marketerName: currentUser.name,
      createdAt: editingId ? formData.createdAt : new Date().toISOString()
    };

    try {
      await storage.set(`visit:${visit.id}`, JSON.stringify(visit));
      
      if (formData.reminderDate && formData.reminderNote) {
        const reminder = {
          id: `rem_${Date.now()}`,
          visitId: visit.id,
          clientName: visit.clientName,
          reminderDate: formData.reminderDate,
          reminderNote: formData.reminderNote,
          marketer: currentUser.username,
          completed: false
        };
        await storage.set(`reminder:${reminder.id}`, JSON.stringify(reminder));
      }
      
      await loadData();
      resetForm();
    } catch (error) {
      console.error('Save error:', error);
    }
  };

  const deleteVisit = async (id) => {
    if (!confirm('Delete this visit?')) return;
    try {
      await storage.delete(`visit:${id}`);
      await loadData();
    } catch (error) {
      console.error('Delete error:', error);
    }
  };

  const completeReminder = async (id) => {
    try {
      const result = await storage.get(`reminder:${id}`);
      if (result) {
        const reminder = JSON.parse(result.value);
        reminder.completed = true;
        await storage.set(`reminder:${id}`, JSON.stringify(reminder));
        await loadData();
      }
    } catch (error) {
      console.error('Complete error:', error);
    }
  };

  const deleteUser = async (username) => {
    if (!confirm(`Delete user ${username}?`)) return;
    try {
      const updated = users.filter(u => u.username !== username);
      await storage.set('hospice:users', JSON.stringify(updated));
      setUsers(updated);
    } catch (error) {
      console.error('Delete user error:', error);
    }
  };

  const resetForm = () => {
    setFormData({
      clientName: '', clientAddress: '', clientEmail: '', contactPerson: '',
      visitDate: new Date().toISOString().split('T')[0], notes: '',
      patients: [], reminderDate: '', reminderNote: ''
    });
    setEditingId(null);
    setShowForm(false);
    setClientSearch('');
  };

  const startEdit = (visit) => {
    setFormData(visit);
    setEditingId(visit.id);
    setClientSearch(visit.clientName);
    setShowForm(true);
    setActiveView('visits');
  };

  const exportData = () => {
    const csv = [
      ['Date', 'Marketer', 'Client', 'Address', 'Contact', 'Email', 'Leads', 'Admissions', 'Patients', 'Notes'].join(','),
      ...visits.map(v => [
        v.visitDate,
        v.marketerName,
        v.clientName,
        v.clientAddress || '',
        v.contactPerson || '',
        v.clientEmail || '',
        v.patients?.filter(p => p.type === 'lead').length || 0,
        v.patients?.filter(p => p.type === 'admission').length || 0,
        v.patients?.map(p => `${p.name}${p.phone ? ' ' + p.phone : ''} (${p.type})`).join('; ') || '',
        (v.notes || '').replace(/"/g, '""')
      ].map(f => `"${f}"`).join(','))
    ].join('\n');

    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `expert-hospice-${new Date().toISOString().split('T')[0]}.csv`;
    a.click();
  };

  const stats = {
    totalLocations: clients.length,
    totalVisits: visits.length,
    totalLeads: visits.reduce((sum, v) => sum + (v.patients?.filter(p => p.type === 'lead').length || 0), 0),
    totalAdmissions: visits.reduce((sum, v) => sum + (v.patients?.filter(p => p.type === 'admission').length || 0), 0),
    upcomingReminders: reminders.filter(r => new Date(r.reminderDate) >= new Date()).length
  };
  stats.conversionRate = stats.totalLeads > 0 ? ((stats.totalAdmissions / stats.totalLeads) * 100).toFixed(1) : 0;

  const filteredClients = clients.filter(c => c.name.toLowerCase().includes(clientSearch.toLowerCase()));

  // Login Screen
  if (!currentUser) {
    return (
      <div style={{ minHeight: '100vh', background: 'linear-gradient(135deg, #1e3a5f 0%, #2d5a7b 100%)', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '2rem', fontFamily: 'system-ui, sans-serif' }}>
        <div style={{ background: 'white', borderRadius: '24px', padding: '3rem', maxWidth: '420px', width: '100%', boxShadow: '0 20px 60px rgba(0,0,0,0.3)' }}>
          <div style={{ textAlign: 'center', marginBottom: '2rem' }}>
            <div style={{ width: '100px', height: '100px', margin: '0 auto 1.5rem', borderRadius: '50%', background: '#f0f4f8', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '3rem' }}>üè•</div>
            <h1 style={{ fontSize: '1.75rem', fontWeight: '800', color: '#1e3a5f', margin: '0 0 0.5rem 0' }}>Expert Hospice</h1>
            <p style={{ fontSize: '0.95rem', color: '#64748b', margin: 0 }}>Marketing Tracker</p>
          </div>

          <div style={{ marginBottom: '1.5rem' }}>
            <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.875rem', fontWeight: '600', color: '#475569' }}>Username</label>
            <input
              type="text"
              value={loginForm.username}
              onChange={(e) => setLoginForm({...loginForm, username: e.target.value})}
              onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
              placeholder="Enter username"
              style={{ width: '100%', padding: '0.875rem', border: '2px solid #e2e8f0', borderRadius: '12px', fontSize: '1rem', outline: 'none' }}
            />
          </div>

          <div style={{ marginBottom: '1.5rem' }}>
            <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.875rem', fontWeight: '600', color: '#475569' }}>4-Digit PIN</label>
            <input
              type="password"
              inputMode="numeric"
              maxLength="4"
              value={loginForm.pin}
              onChange={(e) => {
                const value = e.target.value.replace(/\D/g, '');
                setLoginForm({...loginForm, pin: value});
              }}
              onKeyPress={(e) => {
                if (e.key === 'Enter') handleLogin();
                // Only allow numbers
                if (!/[0-9]/.test(e.key)) e.preventDefault();
              }}
              placeholder="Enter 4 digits"
              style={{ width: '100%', padding: '0.875rem', border: '2px solid #e2e8f0', borderRadius: '12px', fontSize: '1.5rem', letterSpacing: '0.5rem', outline: 'none', textAlign: 'center' }}
            />
            <p style={{ fontSize: '0.75rem', color: '#64748b', marginTop: '0.5rem', marginBottom: 0 }}>
              {loginForm.pin.length}/4 digits
            </p>
          </div>

          {loginError && (
            <div style={{ padding: '0.75rem', background: '#fef2f2', border: '1px solid #fecaca', borderRadius: '8px', color: '#dc2626', fontSize: '0.875rem', marginBottom: '1.5rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
              <AlertCircle size={16} />
              {loginError}
            </div>
          )}

          <button
            onClick={handleLogin}
            style={{ width: '100%', padding: '1rem', background: 'linear-gradient(135deg, #2d5a7b 0%, #1e3a5f 100%)', border: 'none', borderRadius: '12px', color: 'white', fontSize: '1rem', fontWeight: '600', cursor: 'pointer' }}
          >
            Sign In
          </button>

          <p style={{ marginTop: '1.5rem', fontSize: '0.875rem', color: '#94a3b8', textAlign: 'center' }}>
            First time? Your PIN will be set on first login.<br/>
            <span style={{ fontSize: '0.8rem', marginTop: '0.5rem', display: 'block' }}>
              Valid users: denise, braxton, liesa, veronica, skrishnan, mranat, bmartin, jgiedt
            </span>
          </p>
        </div>
      </div>
    );
  }

  // Main App
  return (
    <div style={{ minHeight: '100vh', background: '#f8fafc', fontFamily: 'system-ui, sans-serif' }}>
      {/* Top Bar */}
      <div style={{ background: 'white', borderBottom: '1px solid #e2e8f0', padding: '1rem 2rem', display: 'flex', justifyContent: 'space-between', alignItems: 'center', position: 'sticky', top: 0, zIndex: 100 }}>
        <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
          <div style={{ width: '50px', height: '50px', borderRadius: '12px', background: '#f0f4f8', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '1.5rem' }}>üè•</div>
          <div>
            <h1 style={{ fontSize: '1.25rem', fontWeight: '700', color: '#1e3a5f', margin: 0 }}>Expert Hospice Tracker</h1>
            <p style={{ fontSize: '0.875rem', color: '#64748b', margin: 0 }}>{currentUser.name} {currentUser.role === 'admin' && '(Admin)'}</p>
          </div>
        </div>

        <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
          {reminders.length > 0 && (
            <div onClick={() => setActiveView('reminders')} style={{ position: 'relative', padding: '0.5rem', background: '#fef3c7', borderRadius: '8px', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
              <Bell size={18} color="#d97706" />
              <span style={{ fontSize: '0.75rem', fontWeight: '600', color: '#d97706' }}>{reminders.length}</span>
            </div>
          )}
          
          <button onClick={() => setCurrentUser(null)} style={{ padding: '0.5rem 1rem', background: 'transparent', border: '1px solid #e2e8f0', borderRadius: '8px', color: '#64748b', fontSize: '0.875rem', fontWeight: '600', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
            <LogOut size={16} />
            Logout
          </button>
        </div>
      </div>

      <div style={{ display: 'flex', minHeight: 'calc(100vh - 82px)' }}>
        {/* Sidebar */}
        <div style={{ width: '240px', background: 'white', borderRight: '1px solid #e2e8f0', padding: '1.5rem 0' }}>
          {[
            { id: 'dashboard', icon: Home, label: 'Dashboard' },
            { id: 'visits', icon: MapPin, label: 'Visits' },
            { id: 'analytics', icon: BarChart3, label: 'Analytics' },
            { id: 'reminders', icon: Bell, label: 'Reminders', badge: reminders.length },
            ...(currentUser.role === 'admin' ? [{ id: 'users', icon: Users, label: 'Users' }] : [])
          ].map(item => (
            <button
              key={item.id}
              onClick={() => setActiveView(item.id)}
              style={{ width: '100%', padding: '0.875rem 1.5rem', background: activeView === item.id ? '#eff6ff' : 'transparent', border: 'none', borderLeft: activeView === item.id ? '3px solid #2d5a7b' : '3px solid transparent', color: activeView === item.id ? '#2d5a7b' : '#64748b', fontSize: '0.9375rem', fontWeight: activeView === item.id ? '600' : '500', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '0.75rem', textAlign: 'left', justifyContent: 'space-between' }}
            >
              <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem' }}>
                <item.icon size={18} />
                {item.label}
              </div>
              {item.badge > 0 && <span style={{ background: '#dc2626', color: 'white', fontSize: '0.75rem', fontWeight: '600', padding: '0.125rem 0.5rem', borderRadius: '12px', minWidth: '20px', textAlign: 'center' }}>{item.badge}</span>}
            </button>
          ))}
        </div>

        {/* Main Content */}
        <div style={{ flex: 1, padding: '2rem', overflowY: 'auto' }}>
          {/* Dashboard */}
          {activeView === 'dashboard' && (
            <div>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '2rem' }}>
                <h2 style={{ fontSize: '1.875rem', fontWeight: '700', color: '#1e293b', margin: 0 }}>Dashboard</h2>
                <div style={{ display: 'flex', gap: '1rem' }}>
                  {currentUser.role === 'admin' && (
                    <button onClick={exportData} style={{ padding: '0.75rem 1.5rem', background: 'white', border: '1px solid #e2e8f0', borderRadius: '10px', color: '#2d5a7b', fontSize: '0.9375rem', fontWeight: '600', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                      <Download size={18} />
                      Export CSV
                    </button>
                  )}
                  <button onClick={() => { setShowForm(true); setActiveView('visits'); }} style={{ padding: '0.75rem 1.5rem', background: 'linear-gradient(135deg, #2d5a7b 0%, #1e3a5f 100%)', border: 'none', borderRadius: '10px', color: 'white', fontSize: '0.9375rem', fontWeight: '600', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '0.5rem', boxShadow: '0 4px 12px rgba(45,90,123,0.2)' }}>
                    <Plus size={18} />
                    New Visit
                  </button>
                </div>
              </div>

              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '1.5rem', marginBottom: '2rem' }}>
                {[
                  { label: 'Total Locations', value: stats.totalLocations, icon: MapPin, color: '#2d5a7b' },
                  { label: 'Total Visits', value: stats.totalVisits, icon: Calendar, color: '#7c3aed' },
                  { label: 'Total Leads', value: stats.totalLeads, icon: TrendingUp, color: '#0891b2' },
                  { label: 'Admissions', value: stats.totalAdmissions, icon: User, color: '#16a34a' },
                  { label: 'Conversion Rate', value: `${stats.conversionRate}%`, icon: BarChart3, color: '#dc2626' },
                  { label: 'Reminders', value: stats.upcomingReminders, icon: Clock, color: '#d97706' }
                ].map((stat, i) => (
                  <div key={i} style={{ background: 'white', borderRadius: '16px', padding: '1.5rem', border: '1px solid #e2e8f0' }}>
                    <div style={{ width: '48px', height: '48px', borderRadius: '12px', background: `${stat.color}15`, display: 'flex', alignItems: 'center', justifyContent: 'center', marginBottom: '1rem' }}>
                      <stat.icon size={24} color={stat.color} />
                    </div>
                    <div style={{ fontSize: '2rem', fontWeight: '700', color: '#1e293b', marginBottom: '0.25rem' }}>{stat.value}</div>
                    <div style={{ fontSize: '0.875rem', color: '#64748b', fontWeight: '500' }}>{stat.label}</div>
                  </div>
                ))}
              </div>

              <div style={{ background: 'white', borderRadius: '16px', padding: '1.5rem', border: '1px solid #e2e8f0' }}>
                <h3 style={{ fontSize: '1.125rem', fontWeight: '700', color: '#1e293b', marginBottom: '1rem' }}>Recent Visits</h3>
                {visits.slice(0, 5).map(visit => (
                  <div key={visit.id} style={{ padding: '1rem', borderBottom: '1px solid #f1f5f9', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                    <div>
                      <div style={{ fontSize: '1rem', fontWeight: '600', color: '#1e293b', marginBottom: '0.25rem' }}>{visit.clientName}</div>
                      <div style={{ fontSize: '0.875rem', color: '#64748b' }}>
                        {currentUser.role === 'admin' && `${visit.marketerName} ‚Ä¢ `}
                        {new Date(visit.visitDate).toLocaleDateString()} ‚Ä¢ 
                        {visit.patients?.filter(p => p.type === 'lead').length || 0} leads, 
                        {visit.patients?.filter(p => p.type === 'admission').length || 0} admissions
                      </div>
                    </div>
                    <button onClick={() => startEdit(visit)} style={{ padding: '0.5rem', background: 'transparent', border: 'none', color: '#2d5a7b', cursor: 'pointer', borderRadius: '8px' }}>
                      <Edit2 size={18} />
                    </button>
                  </div>
                ))}
              </div>
            </div>
          )}

          {/* Visits */}
          {activeView === 'visits' && (
            <div>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '2rem' }}>
                <h2 style={{ fontSize: '1.875rem', fontWeight: '700', color: '#1e293b', margin: 0 }}>Visits</h2>
                {!showForm && (
                  <button onClick={() => setShowForm(true)} style={{ padding: '0.75rem 1.5rem', background: 'linear-gradient(135deg, #2d5a7b 0%, #1e3a5f 100%)', border: 'none', borderRadius: '10px', color: 'white', fontSize: '0.9375rem', fontWeight: '600', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '0.5rem', boxShadow: '0 4px 12px rgba(45,90,123,0.2)' }}>
                    <Plus size={18} />
                    New Visit
                  </button>
                )}
              </div>

              {showForm && (
                <div style={{ background: 'white', borderRadius: '16px', padding: '2rem', marginBottom: '2rem', border: '1px solid #e2e8f0' }}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>
                    <h3 style={{ fontSize: '1.25rem', fontWeight: '700', color: '#1e293b', margin: 0 }}>{editingId ? 'Edit Visit' : 'New Visit'}</h3>
                    <button onClick={resetForm} style={{ background: 'transparent', border: 'none', color: '#64748b', cursor: 'pointer', padding: '0.5rem' }}>
                      <X size={24} />
                    </button>
                  </div>

                  {/* Client Search */}
                  <div style={{ marginBottom: '1.5rem', position: 'relative' }}>
                    <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.875rem', fontWeight: '600', color: '#475569' }}>Client Name *</label>
                    <div style={{ position: 'relative' }}>
                      <input
                        type="text"
                        value={clientSearch}
                        onChange={(e) => { setClientSearch(e.target.value); setFormData({...formData, clientName: e.target.value}); setShowSuggestions(true); }}
                        onFocus={() => setShowSuggestions(true)}
                        placeholder="Search or enter client name"
                        style={{ width: '100%', padding: '0.875rem 2.5rem 0.875rem 0.875rem', border: '2px solid #e2e8f0', borderRadius: '10px', fontSize: '1rem', outline: 'none' }}
                      />
                      <Search size={20} style={{ position: 'absolute', right: '0.875rem', top: '50%', transform: 'translateY(-50%)', color: '#94a3b8' }} />
                    </div>

                    {showSuggestions && filteredClients.length > 0 && clientSearch && (
                      <div style={{ position: 'absolute', top: '100%', left: 0, right: 0, background: 'white', border: '2px solid #e2e8f0', borderRadius: '10px', marginTop: '0.5rem', maxHeight: '200px', overflowY: 'auto', zIndex: 10, boxShadow: '0 4px 12px rgba(0,0,0,0.1)' }}>
                        {filteredClients.map((client, i) => (
                          <div key={i} onClick={() => selectClient(client)} onMouseDown={(e) => e.preventDefault()} style={{ padding: '0.875rem', cursor: 'pointer', borderBottom: i < filteredClients.length - 1 ? '1px solid #f1f5f9' : 'none' }}>
                            <div style={{ fontSize: '0.9375rem', fontWeight: '600', color: '#1e293b', marginBottom: '0.25rem' }}>{client.name}</div>
                            <div style={{ fontSize: '0.8125rem', color: '#64748b' }}>{client.address} ‚Ä¢ Last: {new Date(client.lastVisit).toLocaleDateString()}</div>
                          </div>
                        ))}
                      </div>
                    )}
                  </div>

                  <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '1.25rem', marginBottom: '1.5rem' }}>
                    <div>
                      <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.875rem', fontWeight: '600', color: '#475569' }}>Address</label>
                      <input type="text" value={formData.clientAddress} onChange={(e) => setFormData({...formData, clientAddress: e.target.value})} placeholder="123 Main St" style={{ width: '100%', padding: '0.875rem', border: '2px solid #e2e8f0', borderRadius: '10px', fontSize: '1rem', outline: 'none' }} />
                    </div>
                    <div>
                      <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.875rem', fontWeight: '600', color: '#475569' }}>Contact Person</label>
                      <input type="text" value={formData.contactPerson} onChange={(e) => setFormData({...formData, contactPerson: e.target.value})} placeholder="John Smith" style={{ width: '100%', padding: '0.875rem', border: '2px solid #e2e8f0', borderRadius: '10px', fontSize: '1rem', outline: 'none' }} />
                    </div>
                    <div>
                      <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.875rem', fontWeight: '600', color: '#475569' }}>Email</label>
                      <input type="email" value={formData.clientEmail} onChange={(e) => setFormData({...formData, clientEmail: e.target.value})} placeholder="contact@facility.com" style={{ width: '100%', padding: '0.875rem', border: '2px solid #e2e8f0', borderRadius: '10px', fontSize: '1rem', outline: 'none' }} />
                    </div>
                    <div>
                      <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.875rem', fontWeight: '600', color: '#475569' }}>Visit Date *</label>
                      <input type="date" value={formData.visitDate} onChange={(e) => setFormData({...formData, visitDate: e.target.value})} style={{ width: '100%', padding: '0.875rem', border: '2px solid #e2e8f0', borderRadius: '10px', fontSize: '1rem', outline: 'none' }} />
                    </div>
                  </div>

                  {/* Patient Entry */}
                  <div style={{ background: '#f8fafc', borderRadius: '12px', padding: '1.5rem', marginBottom: '1.5rem' }}>
                    <h4 style={{ fontSize: '1rem', fontWeight: '700', color: '#1e293b', marginBottom: '1rem' }}>Add Lead or Admission</h4>
                    <div style={{ display: 'grid', gridTemplateColumns: '2fr 1.5fr 1fr auto', gap: '1rem', alignItems: 'end', marginBottom: '1rem' }}>
                      <div>
                        <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.8125rem', fontWeight: '600', color: '#475569' }}>Patient Name</label>
                        <input type="text" value={patientForm.name} onChange={(e) => setPatientForm({...patientForm, name: e.target.value})} placeholder="Patient name" style={{ width: '100%', padding: '0.75rem', border: '2px solid #e2e8f0', borderRadius: '8px', fontSize: '0.9375rem', outline: 'none' }} />
                      </div>
                      <div>
                        <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.8125rem', fontWeight: '600', color: '#475569' }}>Phone (Optional)</label>
                        <input type="tel" value={patientForm.phone} onChange={(e) => setPatientForm({...patientForm, phone: e.target.value})} placeholder="555-1234" style={{ width: '100%', padding: '0.75rem', border: '2px solid #e2e8f0', borderRadius: '8px', fontSize: '0.9375rem', outline: 'none' }} />
                      </div>
                      <div>
                        <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.8125rem', fontWeight: '600', color: '#475569' }}>Type</label>
                        <select value={patientForm.type} onChange={(e) => setPatientForm({...patientForm, type: e.target.value})} style={{ width: '100%', padding: '0.75rem', border: '2px solid #e2e8f0', borderRadius: '8px', fontSize: '0.9375rem', outline: 'none', cursor: 'pointer', background: 'white' }}>
                          <option value="lead">Lead</option>
                          <option value="admission">Admission</option>
                        </select>
                      </div>
                      <button onClick={addPatient} disabled={!patientForm.name} style={{ padding: '0.75rem 1rem', background: patientForm.name ? '#2d5a7b' : '#e2e8f0', border: 'none', borderRadius: '8px', color: 'white', fontSize: '0.9375rem', fontWeight: '600', cursor: patientForm.name ? 'pointer' : 'not-allowed', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                        <Plus size={16} />
                        Add
                      </button>
                    </div>

                    {formData.patients.length > 0 && (
                      <div style={{ marginTop: '1rem' }}>
                        <div style={{ fontSize: '0.875rem', fontWeight: '600', color: '#475569', marginBottom: '0.75rem', display: 'flex', gap: '1rem' }}>
                          <span>Leads: {formData.patients.filter(p => p.type === 'lead').length}</span>
                          <span>Admissions: {formData.patients.filter(p => p.type === 'admission').length}</span>
                        </div>
                        <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>
                          {formData.patients.map(patient => (
                            <div key={patient.id} style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '0.75rem', background: 'white', borderRadius: '8px', border: '1px solid #e2e8f0' }}>
                              <div>
                                <span style={{ fontSize: '0.9375rem', fontWeight: '600', color: '#1e293b', marginRight: '0.5rem' }}>{patient.name}</span>
                                {patient.phone && <span style={{ fontSize: '0.875rem', color: '#64748b' }}>‚Ä¢ {patient.phone}</span>}
                                <span style={{ marginLeft: '0.75rem', padding: '0.125rem 0.5rem', borderRadius: '4px', fontSize: '0.75rem', fontWeight: '600', background: patient.type === 'admission' ? '#dcfce7' : '#dbeafe', color: patient.type === 'admission' ? '#16a34a' : '#0284c7' }}>{patient.type}</span>
                              </div>
                              <button onClick={() => removePatient(patient.id)} style={{ background: 'transparent', border: 'none', color: '#dc2626', cursor: 'pointer', padding: '0.25rem' }}>
                                <Trash2 size={16} />
                              </button>
                            </div>
                          ))}
                        </div>
                      </div>
                    )}
                  </div>

                  {/* Notes */}
                  <div style={{ marginBottom: '1.5rem' }}>
                    <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.875rem', fontWeight: '600', color: '#475569' }}>Visit Notes</label>
                    <textarea value={formData.notes} onChange={(e) => setFormData({...formData, notes: e.target.value})} placeholder="Meeting notes, outcomes..." rows={4} style={{ width: '100%', padding: '0.875rem', border: '2px solid #e2e8f0', borderRadius: '10px', fontSize: '1rem', outline: 'none', resize: 'vertical' }} />
                  </div>

                  {/* Reminder */}
                  <div style={{ background: '#fef3c7', borderRadius: '12px', padding: '1.5rem', marginBottom: '1.5rem' }}>
                    <h4 style={{ fontSize: '1rem', fontWeight: '700', color: '#78350f', marginBottom: '1rem', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                      <Clock size={18} />
                      Follow-up Reminder (Optional)
                    </h4>
                    <div style={{ display: 'grid', gridTemplateColumns: '200px 1fr', gap: '1rem' }}>
                      <div>
                        <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.8125rem', fontWeight: '600', color: '#78350f' }}>Date</label>
                        <input type="date" value={formData.reminderDate} onChange={(e) => setFormData({...formData, reminderDate: e.target.value})} min={new Date().toISOString().split('T')[0]} style={{ width: '100%', padding: '0.75rem', border: '2px solid #fbbf24', borderRadius: '8px', fontSize: '0.9375rem', outline: 'none', background: 'white' }} />
                      </div>
                      <div>
                        <label style={{ display: 'block', marginBottom: '0.5rem', fontSize: '0.8125rem', fontWeight: '600', color: '#78350f' }}>Note</label>
                        <input type="text" value={formData.reminderNote} onChange={(e) => setFormData({...formData, reminderNote: e.target.value})} placeholder="Follow up on referral" style={{ width: '100%', padding: '0.75rem', border: '2px solid #fbbf24', borderRadius: '8px', fontSize: '0.9375rem', outline: 'none', background: 'white' }} />
                      </div>
                    </div>
                  </div>

                  {/* Actions */}
                  <div style={{ display: 'flex', gap: '1rem', justifyContent: 'flex-end' }}>
                    <button onClick={resetForm} style={{ padding: '0.75rem 1.5rem', background: 'transparent', border: '2px solid #e2e8f0', borderRadius: '10px', color: '#64748b', fontSize: '1rem', fontWeight: '600', cursor: 'pointer' }}>Cancel</button>
                    <button onClick={saveVisit} disabled={!formData.clientName || !formData.visitDate} style={{ padding: '0.75rem 1.5rem', background: formData.clientName && formData.visitDate ? 'linear-gradient(135deg, #2d5a7b 0%, #1e3a5f 100%)' : '#e2e8f0', border: 'none', borderRadius: '10px', color: 'white', fontSize: '1rem', fontWeight: '600', cursor: formData.clientName && formData.visitDate ? 'pointer' : 'not-allowed', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                      <Save size={18} />
                      {editingId ? 'Update' : 'Save'}
                    </button>
                  </div>
                </div>
              )}

              {/* Visits List */}
              {!showForm && (
                <div style={{ display: 'grid', gap: '1rem' }}>
                  {visits.length === 0 ? (
                    <div style={{ textAlign: 'center', padding: '4rem', background: 'white', borderRadius: '16px', border: '2px dashed #e2e8f0' }}>
                      <MapPin size={48} color="#cbd5e1" style={{ marginBottom: '1rem' }} />
                      <h3 style={{ fontSize: '1.25rem', fontWeight: '600', color: '#475569', marginBottom: '0.5rem' }}>No visits yet</h3>
                      <p style={{ color: '#94a3b8', fontSize: '1rem' }}>Start tracking your client visits</p>
                    </div>
                  ) : (
                    visits.map(visit => (
                      <div key={visit.id} style={{ background: 'white', borderRadius: '12px', padding: '1.5rem', border: '1px solid #e2e8f0' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '1rem' }}>
                          <div>
                            <h3 style={{ fontSize: '1.25rem', fontWeight: '700', color: '#1e293b', margin: '0 0 0.5rem 0' }}>{visit.clientName}</h3>
                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '1rem', fontSize: '0.875rem', color: '#64748b' }}>
                              {currentUser.role === 'admin' && <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}><User size={14} />{visit.marketerName}</div>}
                              <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}><Calendar size={14} />{new Date(visit.visitDate).toLocaleDateString()}</div>
                              {visit.clientAddress && <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}><MapPin size={14} />{visit.clientAddress}</div>}
                            </div>
                          </div>
                          <div style={{ display: 'flex', gap: '0.5rem' }}>
                            <button onClick={() => startEdit(visit)} style={{ background: '#f1f5f9', border: 'none', borderRadius: '8px', padding: '0.5rem', color: '#2d5a7b', cursor: 'pointer' }}>
                              <Edit2 size={18} />
                            </button>
                            {currentUser.role === 'admin' && (
                              <button onClick={() => deleteVisit(visit.id)} style={{ background: '#fef2f2', border: 'none', borderRadius: '8px', padding: '0.5rem', color: '#dc2626', cursor: 'pointer' }}>
                                <Trash2 size={18} />
                              </button>
                            )}
                          </div>
                        </div>

                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))', gap: '1rem', marginBottom: '1rem' }}>
                          <div style={{ padding: '0.75rem', background: '#dbeafe', borderRadius: '8px' }}>
                            <div style={{ fontSize: '1.5rem', fontWeight: '700', color: '#0284c7', marginBottom: '0.25rem' }}>{visit.patients?.filter(p => p.type === 'lead').length || 0}</div>
                            <div style={{ fontSize: '0.75rem', color: '#0369a1', fontWeight: '600', textTransform: 'uppercase' }}>Leads</div>
                          </div>
                          <div style={{ padding: '0.75rem', background: '#dcfce7', borderRadius: '8px' }}>
                            <div style={{ fontSize: '1.5rem', fontWeight: '700', color: '#16a34a', marginBottom: '0.25rem' }}>{visit.patients?.filter(p => p.type === 'admission').length || 0}</div>
                            <div style={{ fontSize: '0.75rem', color: '#15803d', fontWeight: '600', textTransform: 'uppercase' }}>Admissions</div>
                          </div>
                        </div>

                        {visit.patients?.length > 0 && (
                          <div style={{ marginBottom: '1rem', padding: '1rem', background: '#f8fafc', borderRadius: '8px' }}>
                            <div style={{ fontSize: '0.75rem', fontWeight: '600', color: '#475569', textTransform: 'uppercase', marginBottom: '0.75rem' }}>Patients</div>
                            <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>
                              {visit.patients.map(p => (
                                <div key={p.id} style={{ fontSize: '0.875rem', color: '#475569', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                  <span style={{ padding: '0.125rem 0.5rem', borderRadius: '4px', fontSize: '0.6875rem', fontWeight: '600', background: p.type === 'admission' ? '#dcfce7' : '#dbeafe', color: p.type === 'admission' ? '#16a34a' : '#0284c7' }}>{p.type}</span>
                                  {p.name}
                                  {p.phone && ` ‚Ä¢ ${p.phone}`}
                                </div>
                              ))}
                            </div>
                          </div>
                        )}

                        {visit.notes && (
                          <div style={{ padding: '1rem', background: '#f8fafc', borderRadius: '8px', borderLeft: '3px solid #2d5a7b' }}>
                            <div style={{ fontSize: '0.75rem', fontWeight: '600', color: '#475569', textTransform: 'uppercase', marginBottom: '0.5rem' }}>Notes</div>
                            <p style={{ margin: 0, color: '#64748b', fontSize: '0.9375rem', lineHeight: '1.6' }}>{visit.notes}</p>
                          </div>
                        )}
                      </div>
                    ))
                  )}
                </div>
              )}
            </div>
          )}

          {/* Analytics */}
          {activeView === 'analytics' && (
            <div>
              <h2 style={{ fontSize: '1.875rem', fontWeight: '700', color: '#1e293b', marginBottom: '2rem' }}>Analytics</h2>

              {currentUser.role === 'admin' && (
                <div style={{ background: 'white', borderRadius: '16px', padding: '1.5rem', marginBottom: '2rem', border: '1px solid #e2e8f0' }}>
                  <h3 style={{ fontSize: '1.125rem', fontWeight: '700', color: '#1e293b', marginBottom: '1.5rem' }}>Performance by Marketer</h3>
                  <div style={{ display: 'grid', gap: '1rem' }}>
                    {users.filter(u => u.role === 'marketer').map(marketer => {
                      const mVisits = visits.filter(v => v.marketer === marketer.username);
                      const mStats = {
                        visits: mVisits.length,
                        locations: new Set(mVisits.map(v => v.clientName.toLowerCase())).size,
                        leads: mVisits.reduce((s, v) => s + (v.patients?.filter(p => p.type === 'lead').length || 0), 0),
                        admissions: mVisits.reduce((s, v) => s + (v.patients?.filter(p => p.type === 'admission').length || 0), 0)
                      };
                      mStats.conversion = mStats.leads > 0 ? ((mStats.admissions / mStats.leads) * 100).toFixed(1) : 0;

                      return (
                        <div key={marketer.username} style={{ padding: '1.25rem', background: '#f8fafc', borderRadius: '12px', border: '1px solid #e2e8f0' }}>
                          <div style={{ fontSize: '1rem', fontWeight: '700', color: '#1e293b', marginBottom: '1rem' }}>{marketer.name}</div>
                          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(100px, 1fr))', gap: '1rem' }}>
                            {[
                              { label: 'Visits', value: mStats.visits },
                              { label: 'Locations', value: mStats.locations },
                              { label: 'Leads', value: mStats.leads },
                              { label: 'Admits', value: mStats.admissions },
                              { label: 'Conv. %', value: `${mStats.conversion}%` }
                            ].map((s, i) => (
                              <div key={i}>
                                <div style={{ fontSize: '1.5rem', fontWeight: '700', color: '#2d5a7b', marginBottom: '0.25rem' }}>{s.value}</div>
                                <div style={{ fontSize: '0.75rem', color: '#64748b', fontWeight: '600', textTransform: 'uppercase' }}>{s.label}</div>
                              </div>
                            ))}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              )}

              <div style={{ background: 'white', borderRadius: '16px', padding: '1.5rem', border: '1px solid #e2e8f0' }}>
                <h3 style={{ fontSize: '1.125rem', fontWeight: '700', color: '#1e293b', marginBottom: '1.5rem' }}>Top Locations</h3>
                <div style={{ display: 'grid', gap: '1rem' }}>
                  {clients.sort((a, b) => b.totalAdmissions - a.totalAdmissions).slice(0, 10).map((client, i) => (
                    <div key={i} style={{ padding: '1rem', background: '#f8fafc', borderRadius: '8px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                      <div>
                        <div style={{ fontSize: '1rem', fontWeight: '600', color: '#1e293b', marginBottom: '0.25rem' }}>{client.name}</div>
                        <div style={{ fontSize: '0.875rem', color: '#64748b' }}>{client.totalVisits} visits ‚Ä¢ Last: {new Date(client.lastVisit).toLocaleDateString()}</div>
                      </div>
                      <div style={{ display: 'flex', gap: '1rem' }}>
                        <div style={{ textAlign: 'center' }}>
                          <div style={{ fontSize: '1.25rem', fontWeight: '700', color: '#0284c7' }}>{client.totalLeads}</div>
                          <div style={{ fontSize: '0.75rem', color: '#64748b', fontWeight: '600' }}>Leads</div>
                        </div>
                        <div style={{ textAlign: 'center' }}>
                          <div style={{ fontSize: '1.25rem', fontWeight: '700', color: '#16a34a' }}>{client.totalAdmissions}</div>
                          <div style={{ fontSize: '0.75rem', color: '#64748b', fontWeight: '600' }}>Admits</div>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          )}

          {/* Reminders */}
          {activeView === 'reminders' && (
            <div>
              <h2 style={{ fontSize: '1.875rem', fontWeight: '700', color: '#1e293b', marginBottom: '2rem' }}>Reminders</h2>
              {reminders.length === 0 ? (
                <div style={{ textAlign: 'center', padding: '4rem', background: 'white', borderRadius: '16px', border: '2px dashed #e2e8f0' }}>
                  <Bell size={48} color="#cbd5e1" style={{ marginBottom: '1rem' }} />
                  <h3 style={{ fontSize: '1.25rem', fontWeight: '600', color: '#475569', marginBottom: '0.5rem' }}>No reminders</h3>
                  <p style={{ color: '#94a3b8', fontSize: '1rem' }}>Set reminders when logging visits</p>
                </div>
              ) : (
                <div style={{ display: 'grid', gap: '1rem' }}>
                  {reminders.map(r => {
                    const isPast = new Date(r.reminderDate) < new Date();
                    return (
                      <div key={r.id} style={{ background: 'white', borderRadius: '12px', padding: '1.5rem', border: isPast ? '2px solid #fbbf24' : '1px solid #e2e8f0' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
                          <div style={{ flex: 1 }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem', marginBottom: '0.75rem' }}>
                              <div style={{ width: '40px', height: '40px', borderRadius: '10px', background: isPast ? '#fef3c7' : '#f1f5f9', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                                <Bell size={20} color={isPast ? '#d97706' : '#64748b'} />
                              </div>
                              <div>
                                <h3 style={{ fontSize: '1.125rem', fontWeight: '700', color: '#1e293b', margin: 0 }}>{r.clientName}</h3>
                                <div style={{ fontSize: '0.875rem', color: '#64748b' }}>
                                  {currentUser.role === 'admin' && `${r.marketer} ‚Ä¢ `}
                                  Due: {new Date(r.reminderDate).toLocaleDateString()}
                                  {isPast && <span style={{ marginLeft: '0.5rem', padding: '0.125rem 0.5rem', borderRadius: '4px', fontSize: '0.75rem', fontWeight: '600', background: '#fef3c7', color: '#d97706' }}>OVERDUE</span>}
                                </div>
                              </div>
                            </div>
                            <p style={{ margin: '0.75rem 0 0 0', padding: '1rem', background: '#f8fafc', borderRadius: '8px', fontSize: '0.9375rem', color: '#475569', lineHeight: '1.6' }}>{r.reminderNote}</p>
                          </div>
                          <button onClick={() => completeReminder(r.id)} style={{ marginLeft: '1rem', padding: '0.75rem 1.25rem', background: '#16a34a', border: 'none', borderRadius: '8px', color: 'white', fontSize: '0.875rem', fontWeight: '600', cursor: 'pointer', whiteSpace: 'nowrap' }}>
                            Complete
                          </button>
                        </div>
                      </div>
                    );
                  })}
                </div>
              )}
            </div>
          )}

          {/* Users */}
          {activeView === 'users' && currentUser.role === 'admin' && (
            <div>
              <h2 style={{ fontSize: '1.875rem', fontWeight: '700', color: '#1e293b', marginBottom: '2rem' }}>Users</h2>
              <div style={{ background: 'white', borderRadius: '16px', padding: '1.5rem', border: '1px solid #e2e8f0' }}>
                <div style={{ display: 'grid', gap: '1rem' }}>
                  {users.map(user => (
                    <div key={user.username} style={{ padding: '1.25rem', background: '#f8fafc', borderRadius: '12px', border: '1px solid #e2e8f0', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                      <div>
                        <div style={{ fontSize: '1rem', fontWeight: '700', color: '#1e293b', marginBottom: '0.25rem' }}>{user.name}</div>
                        <div style={{ fontSize: '0.875rem', color: '#64748b' }}>
                          @{user.username} ‚Ä¢ 
                          <span style={{ marginLeft: '0.5rem', padding: '0.125rem 0.5rem', borderRadius: '4px', fontSize: '0.75rem', fontWeight: '600', background: user.role === 'admin' ? '#dbeafe' : '#f1f5f9', color: user.role === 'admin' ? '#0284c7' : '#64748b' }}>{user.role}</span>
                          {!user.pin && <span style={{ marginLeft: '0.5rem', padding: '0.125rem 0.5rem', borderRadius: '4px', fontSize: '0.75rem', fontWeight: '600', background: '#fef3c7', color: '#d97706' }}>No PIN set</span>}
                        </div>
                      </div>
                      <button onClick={() => deleteUser(user.username)} style={{ padding: '0.5rem 1rem', background: '#fef2f2', border: '1px solid #fecaca', borderRadius: '8px', color: '#dc2626', fontSize: '0.875rem', fontWeight: '600', cursor: 'pointer' }}>
                        Delete
                      </button>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}

ReactDOM.render(<HospiceTracker />, document.getElementById('root'));
    </script>
</body>
</html>
